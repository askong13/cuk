<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel Admin - Pesona Kebaya</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #FFF7E0;
    }
    .btn {
      padding: 8px 16px;
      font-weight: 600;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .btn-edit {
      background-color: #F59E0B;
      color: white;
    }
    .btn-edit:hover {
      background-color: #d97706;
    }
    .btn-reset {
      background-color: #DC2626;
      color: white;
    }
    .btn-reset:hover {
      background-color: #b91c1c;
    }
  </style>
</head>
<body class="text-gray-900 flex flex-col min-h-screen">

  <header class="bg-[#FFC236] shadow p-6 text-center text-white font-extrabold text-3xl">
    Panel Admin
    <p class="text-base font-medium mt-2">Pesona Kebaya Nusantara</p>
  </header>

  <main class="flex-grow p-6 max-w-6xl mx-auto">
    <div class="mb-6 text-right">
      <button id="resetAllBtn" class="btn btn-reset">üîÑ Reset Semua Check-in</button>
    </div>

    <div class="overflow-x-auto bg-white rounded-xl shadow p-6">
      <table class="min-w-full table-auto border-collapse">
        <thead class="bg-yellow-100 text-gray-700">
          <tr>
            <th class="border-b-2 border-gray-300 p-3 text-left">Nama</th>
            <th class="border-b-2 border-gray-300 p-3 text-center">Status</th>
            <th class="border-b-2 border-gray-300 p-3 text-center">Jam Check-in</th>
            <th class="border-b-2 border-gray-300 p-3 text-center">Aksi</th>
          </tr>
        </thead>
        <tbody id="guest-list" class="text-center">
          <!-- Data tamu diisi di sini -->
        </tbody>
      </table>
    </div>
  </main>

  <footer class="bg-white p-4 text-center text-sm text-gray-500 mt-6">
    Partner with <a href="https://siskahandiska.com/" class="text-blue-600 font-semibold" target="_blank">Siska Handiska Creative</a>
  </footer>

<!-- üü° HANYA BAGIAN SCRIPT DI BAWAH SAJA YANG DIREVISI -->

<script>
  const tbody = document.getElementById("guest-list");
  let guestData = {}; // disimpan global agar bisa dipakai untuk reset

  function loadGuests() {
    tbody.innerHTML = '';
    fetch("https://harikebaya-2025-default-rtdb.firebaseio.com/guests.json")
      .then(res => res.json())
      .then(data => {
        guestData = data || {};
        Object.entries(guestData).forEach(([id, guest]) => {
          const name = guest.name || '(Tanpa Nama)';
          const checkedIn = guest.checkedIn ? '‚úÖ' : '‚ùå';
          const time = guest.checkinTime
            ? new Date(guest.checkinTime).toLocaleString("id-ID")
            : '-';
          const row = document.createElement("tr");
          row.className = "hover:bg-yellow-50";
          row.innerHTML = `
            <td class="p-3 font-medium">${name}</td>
            <td class="p-3 text-center">${checkedIn}</td>
            <td class="p-3 text-center">${time}</td>
            <td class="p-3 text-center">
              <button class="btn btn-edit" onclick="toggleCheckIn('${id}', ${guest.checkedIn})">‚úèÔ∏è Edit</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });
  }

  function toggleCheckIn(id, currentStatus) {
    const newStatus = !currentStatus;
    const updateData = {
      checkedIn: newStatus,
      checkinTime: newStatus ? new Date().toISOString() : null
    };

    fetch(`https://harikebaya-2025-default-rtdb.firebaseio.com/guests/${id}.json`, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(updateData)
    }).then(() => {
      loadGuests();
    });
  }

  document.getElementById("resetAllBtn").addEventListener("click", () => {
    if (!confirm("Yakin ingin mereset semua check-in?")) return;

    const promises = [];

    Object.entries(guestData || {}).forEach(([id, guest]) => {
      const name = guest.name || "(Tanpa Nama)";
      const resetData = {
        name: name, // <-- tambahkan ini agar tidak hilang saat reset
        checkedIn: false,
        checkinTime: null
      };

      promises.push(
        fetch(`https://harikebaya-2025-default-rtdb.firebaseio.com/guests/${id}.json`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(resetData)
        })
      );
    });

    Promise.all(promises).then(() => {
      loadGuests();
      alert("‚úÖ Semua status check-in telah direset!");
    });
  });

  loadGuests();
</script>
</body>
</html>